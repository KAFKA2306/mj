# 麻雀シナリオ理論と検証ロジック (Scenario Theory & Logic)

本ドキュメントでは、各トレーニングシナリオにおける「正解」の根拠となる麻雀理論と、システム内部での検証ロジック（`ScenarioValidator`）について解説します。

## 1. 一向聴マスター (1-Shanten Mastery / Efficiency)

### 理論的背景 (Theory)
一向聴（イーシャンテン）において最も重要な指標は「受け入れ枚数（Ukeire）」と「シャンテン数」です。
現代麻雀のセオリー（所謂「科学する麻雀」以降の理論）では、以下の優先順位で打牌を選択します。

1.  **シャンテン数を維持する**: 聴牌（テンパイ）までの距離を遠ざける打牌は原則として悪手です。
2.  **最大受け入れ枚数**: 聴牌に至るための有効牌（Waiting Tiles）の枚数を最大化します。
3.  **良形変化**: 受け入れ枚数が同等、あるいは僅差の場合、最終的な待ちが良形（両面以上）になりやすい牌を残します。

### 検証ロジック (Logic)
システムは以下の基準でユーザーの打牌を判定します。

*   **Bad**: 打牌によってシャンテン数が下がった場合（例：1向聴 → 2向聴）。これは「戻り」と呼ばれ、明確なミスとみなされます。
*   **Suboptimal**: シャンテン数は維持したが、受け入れ枚数が最大値と比較して著しく減少した場合（ロス > 2枚など）。
*   **Excellent/Good**: 受け入れ枚数が最大、あるいは最大とほぼ同等（微差）の場合。

---

## 2. リーチ判断 (Riichi Decision)

### 理論的背景 (Theory)
「リーチするか、ダマテン（闇聴）にするか」は、期待値（Expected Value: EV）の比較によって判断されます。

*   **リーチ有利な条件**:
    *   **打点上昇**: リーチによって打点が大きく上がる（例：のみ手 → リーチ・裏1）。
    *   **良形待ち**: 両面待ちなど、ツモ率・和了率が高い状態。
    *   **先制**: 他家がテンパイしていない（ように見える）序盤・中盤。
*   **ダマテン有利な条件**:
    *   **手替わり**: 変化すれば打点や待ちが劇的に良くなる場合。
    *   **高打点**: ダマテンですでに満貫以上あり、リーチによる打点上昇の恩恵が少ない場合。
    *   **守備的**: 危険な状態で、いつでもオリられるようにしたい場合。

### 検証ロジック (Logic)
システムは `ExpectedValue` (EV) を算出して比較します。

*   `EV(Riichi) > EV(Dama) * 1.2` (有意な差がある) → **リーチ推奨**（しない場合はミス）。
*   `EV(Dama)` が高く、`EV(Riichi)` との差が小さい → **ダマテンも正解**。
*   基本的には「先制良形はリーチ」のセオリーに従い、攻撃的な選択を高く評価する傾向にあります。

---

## 3. 防御・守備 (Defensive Play)

### 理論的背景 (Theory)
守備シナリオでは、相手からの攻撃（リーチ等）を想定し、「放銃率（Deal-in Rate）」を最小化することが求められます。

*   **安全牌の階層**:
    1.  **現物 (Genbutsu)**: 相手が捨てた牌（100%安全）。
    2.  **字牌 (Honors)**: 特に場に出ているオタ風などは安全度が高い。
    3.  **スジ (Suji)**: 両面待ちに当たらない牌（例：4が切れている時の1と7）。
    4.  **カベ (Kabe)**: 自身で4枚見えている牌の外側。

### 検証ロジック (Logic)
ユーザーが選んだ打牌の「安全性」を判定します。

*   **Dangerous**: 無筋（スジではない）の中張牌（数牌の真ん中）など、放銃リスクが高い牌。
*   **Aggressive**: 危険牌だが、自身の手が勝負手（テンパイ等）である場合、「押す」判断として許容されることがあります。
*   **Excellent**: 現物やスジなど、理論的に安全度が保証されている牌。

---

## 4. 手役作り (Yaku Building)

### 理論的背景 (Theory)
単なる効率だけでなく、特定の役（Yaku）を狙うことで打点を高める技術です。

*   **タンヤオ**: 1,9,字牌を切り、2~8の牌を残す。
*   **三色同順**: 異なる色で同じ数字の順子を作る意識。
*   **一気通貫**: 同色で1~9を揃える意識。

### 検証ロジック (Logic)
指定されたシナリオの「ターゲット役」への適合性を判定します。

*   効率（受け入れ枚数）を多少犠牲にしても、**手役の確定**や**手役の種**を残す打牌が高く評価されます。
*   逆に、効率が良くても手役を消してしまう打牌（例：タンヤオ狙いで2を切り1を残す）は低評価となります。

---

## 5. 相手読み (Opponent Reading)

詳細な読みの技術については [OPPONENT_READING.md](./OPPONENT_READING.md) を参照してください。
検証では、以下の行動を評価します。

*   **手出し・ツモ切りの記憶**: 相手の手出し牌周辺を警戒できているか。
*   **対応**: 相手のリーチや露骨な染め手に対して、適切なタイミングでベタオリ（防御）に切り替えられているか。

---

## 6. 手札枚数と鳴き (Hand Count & Live State)

### 手札枚数 (Hand Count)
副露（ポン・チー・カン）によって手牌が短くなることは、守備力に直結します。

*   **守備力の低下**: 手牌が少ないと（例：裸単騎）、リーチが入った際に安全牌を選べる選択肢が激減します。
*   **読みやすさ**: 副露した牌と手出し牌の関係から、聴牌形や待ちが限定されやすくなります。

### 明けている状態 (Akete / Open Hand)
「明けた」状態（鳴きを入れた状態）では、戦略が大きく変わります。

*   **役の制約**: リーチができなくなり、役牌やタンヤオ、染め手などに役が限定されます。
*   **速度勝負**: 打点が下がることが多いため、速度（聴牌までの速さ）がより重要視されます。
*   **食い下がり**: サンショクや一気通貫など、鳴くと翻数が下がる役の価値が変動します。

---

## 7. 場況判断 (Board Situation / Ba no Joukyou)

### 場の状況 (Ba no Joukyou)
自分の手牌だけでなく、卓全体の状況を加味した判断です。

*   **残枚数 (Live Tiles)**: 見えている牌（ドラ表示牌・捨て牌・副露牌）をカウントし、山に残っている有効牌の枚数を把握します。
    *   *例: カンチャン待ちだが、その牌が場に3枚出ていれば、純カラ（残り0枚）であり、どれだけ良形に見えても待ちとしては最悪です。*
*   **点数状況**: オーラスや東場/南場によって、順位点狙いの「着順操作」や、親番維持の「連荘」狙いなど、目標が変わります。
*   **他家の速度**: 相手が早そう（2副露など）ならば、絞る（危険牌を切らない）か、あるいは速度を合わせて勝負するかの判断が求められます。

検証ロジックでは、これらの「場況」を簡易的にシミュレーションし、例えば「残り枚数が極端に少ない待ち」を選んだ場合に警告を出します。

---

## 8. 最新AI理論と応用 (Advanced AI Theory from Deep Research)

中国の麻雀AI研究（Suphx等）や最新のデータ分析から導き出された理論体系です。

### 全局収支予測 (Global Reward Prediction)
従来の「局収支（その局の得点期待値）」だけでなく、「半荘収支（最終的な順位点を含めた期待値）」を最大化する考え方です。
*   **Suphxの強み**: 局の結果が最終順位に与える影響を予測し、トップ目ならリスクを極端に回避し、ラス目なら危険を冒してでも高打点を狙う判断が極めて精緻です。
*   **シナリオへの応用**: 単なる牌効率だけでなく、「点数状況」や「順位」を入力パラメータとした検証ロジックの重要性を示唆しています。

### 先知情報の活用 (Oracle Guiding)
AIの学習過程において、本来見えない「相手の手牌」や「山」の情報をすべて与えて学習させ（Oracle）、徐々に隠していく手法です。
*   **理論的示唆**: 「見えている情報（捨て牌・副露）」から「見えない情報」を推測する精度は、膨大なデータを学習することで飛躍的に向上します。
*   **人間への応用**: 漠然とした「流れ」や「勘」ではなく、**「手出し・ツモ切り」**や**「ラグ」**といった微細な情報を論理的に積み上げることで、AIに近い精度で危険牌を回避できる可能性があります。

### 5ブロック理論とヘッドレス形 (5-Block Theory)
牌効率の基本ですが、AIは特にこれを徹底しています。
*   **5ブロック**: 手牌を5つのブロック（面子または面子候補）に分け、それ以上広げない（6ブロックにしない）ことで、無駄な受け入れを排除し、最短距離で聴牌を目指します。
*   **ヘッドレス**: 雀頭（アタマ）がない形でも、良形ターツが多ければ強力であり、無理にアタマを固定するよりも柔軟に打つことが推奨されます。
