# 麻雀シナリオ理論と検証ロジック (Scenario Theory & Logic)

本ドキュメントでは、各トレーニングシナリオにおける「正解」の根拠となる麻雀理論と、システム内部での検証ロジック（`ScenarioValidator`）について解説します。

## 1. 一向聴マスター (1-Shanten Mastery / Efficiency)

### 理論的背景 (Theory)
一向聴（イーシャンテン）において最も重要な指標は「受け入れ枚数（Ukeire）」と「シャンテン数」です。
現代麻雀のセオリー（所謂「科学する麻雀」以降の理論）では、以下の優先順位で打牌を選択します。

1.  **シャンテン数を維持する**: 聴牌（テンパイ）までの距離を遠ざける打牌は原則として悪手です。
2.  **最大受け入れ枚数**: 聴牌に至るための有効牌（Waiting Tiles）の枚数を最大化します。
3.  **良形変化**: 受け入れ枚数が同等、あるいは僅差の場合、最終的な待ちが良形（両面以上）になりやすい牌を残します。

### 検証ロジック (Logic)
システムは以下の基準でユーザーの打牌を判定します。

*   **Bad**: 打牌によってシャンテン数が下がった場合（例：1向聴 → 2向聴）。これは「戻り」と呼ばれ、明確なミスとみなされます。
*   **Suboptimal**: シャンテン数は維持したが、受け入れ枚数が最大値と比較して著しく減少した場合（ロス > 2枚など）。
*   **Excellent/Good**: 受け入れ枚数が最大、あるいは最大とほぼ同等（微差）の場合。

---

## 2. リーチ判断 (Riichi Decision)

### 理論的背景 (Theory)
「リーチするか、ダマテン（闇聴）にするか」は、期待値（Expected Value: EV）の比較によって判断されます。

*   **リーチ有利な条件**:
    *   **打点上昇**: リーチによって打点が大きく上がる（例：のみ手 → リーチ・裏1）。
    *   **良形待ち**: 両面待ちなど、ツモ率・和了率が高い状態。
    *   **先制**: 他家がテンパイしていない（ように見える）序盤・中盤。
*   **ダマテン有利な条件**:
    *   **手替わり**: 変化すれば打点や待ちが劇的に良くなる場合。
    *   **高打点**: ダマテンですでに満貫以上あり、リーチによる打点上昇の恩恵が少ない場合。
    *   **守備的**: 危険な状態で、いつでもオリられるようにしたい場合。

### 検証ロジック (Logic)
システムは `ExpectedValue` (EV) を算出して比較します。

*   `EV(Riichi) > EV(Dama) * 1.2` (有意な差がある) → **リーチ推奨**（しない場合はミス）。
*   `EV(Dama)` が高く、`EV(Riichi)` との差が小さい → **ダマテンも正解**。
*   基本的には「先制良形はリーチ」のセオリーに従い、攻撃的な選択を高く評価する傾向にあります。

---

## 3. 防御・守備 (Defensive Play)

### 理論的背景 (Theory)
守備シナリオでは、相手からの攻撃（リーチ等）を想定し、「放銃率（Deal-in Rate）」を最小化することが求められます。

*   **安全牌の階層**:
    1.  **現物 (Genbutsu)**: 相手が捨てた牌（100%安全）。
    2.  **字牌 (Honors)**: 特に場に出ているオタ風などは安全度が高い。
    3.  **スジ (Suji)**: 両面待ちに当たらない牌（例：4が切れている時の1と7）。
    4.  **カベ (Kabe)**: 自身で4枚見えている牌の外側。

### 検証ロジック (Logic)
ユーザーが選んだ打牌の「安全性」を判定します。

*   **Dangerous**: 無筋（スジではない）の中張牌（数牌の真ん中）など、放銃リスクが高い牌。
*   **Aggressive**: 危険牌だが、自身の手が勝負手（テンパイ等）である場合、「押す」判断として許容されることがあります。
*   **Excellent**: 現物やスジなど、理論的に安全度が保証されている牌。

---

## 4. 手役作り (Yaku Building)

### 理論的背景 (Theory)
単なる効率だけでなく、特定の役（Yaku）を狙うことで打点を高める技術です。

*   **タンヤオ**: 1,9,字牌を切り、2~8の牌を残す。
*   **三色同順**: 異なる色で同じ数字の順子を作る意識。
*   **一気通貫**: 同色で1~9を揃える意識。

### 検証ロジック (Logic)
指定されたシナリオの「ターゲット役」への適合性を判定します。

*   効率（受け入れ枚数）を多少犠牲にしても、**手役の確定**や**手役の種**を残す打牌が高く評価されます。
*   逆に、効率が良くても手役を消してしまう打牌（例：タンヤオ狙いで2を切り1を残す）は低評価となります。

---

## 5. 相手読み (Opponent Reading)

詳細な読みの技術については [OPPONENT_READING.md](./OPPONENT_READING.md) を参照してください。
検証では、以下の行動を評価します。

*   **手出し・ツモ切りの記憶**: 相手の手出し牌周辺を警戒できているか。
*   **対応**: 相手のリーチや露骨な染め手に対して、適切なタイミングでベタオリ（防御）に切り替えられているか。
